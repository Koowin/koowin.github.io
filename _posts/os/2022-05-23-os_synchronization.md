---
title: "동기화"

toc: true
toc_label: "Contents"
toc_icon: "bars"
toc_sticky: true

categories:
  - os

date: 2022-05-23
last_modified_at: 2022-05-23
sitemap:
  changefreq: daily
  priority: 1.0
---

# 개요

운영체제(공룡책)을 읽고 개인적으로 공부한 내용을 정리하기 위해 작성한 글입니다.

프로세스 동기화 (chapter 6~8) 부분을 읽고 개인적으로 중요하다고 생각되는 부분을 위주로 정리하였습니다.



# 배경

동시에 여러 개의 프로세스가 동일한 자료를 접근하여 조작하고, 이로 인해 발생한 결과가 프로세스들의 접근 순서에 의해 변경되는 경우 **경쟁 상황(race condition)**이라고 한다.

이러한 경우 한 순간에 하나의 프로세스만 해당 변수를 조작하도록 보장해야한다. (동기화)

Mutex, Semaphore 등의 도구를 사용하여 동기화를 하지만, 잘못 사용할 경우 시스템 성능이 저하될 수 있고, 심각하면 **교착 상태**에 빠질 수도 있다.



# 임계구역 (Critical-Section)

경쟁 상황을 유발하는 코드 부분을 의미. 즉, 임계구역에 해당하는 코드 부분은 다른 프로세스와 공유하는 데이터에 접근하고 갱신할 수 있다.

임계구역 문제를 해결하기 위해서 다음 세가지 요구사항이 충족되어야한다.

1. **상호 배제(mutual exclusion)**: A 프로세스가 임계구역을 실행중이면 다른 프로세스는 자신의 임계구역을 실행할 수 없다.
2. **진행(process)**: 임계 구역 실행을 위해 대기 중인 프로세스 중 하나를 택해 임계 구역을 실행하여야 한다. 또한, 언젠가는 반드시 대기 중인 프로세스를 실행해야한다. 
3. **한정된 대기(bounded waiting)**: 임계 구역 진입 요청 후 허용될 때까지 기다리는 횟수에 제한이 있어야한다.



# Mutex Lock

임계구역 문제를 해결하기 위한 가장 간단한 도구.

프로세스는 임계 구역에 들어가기 전에 반드시 락을 획득해야하고, 임계구역을 빠져나올 때 락을 반환해야한다.

# Semaphore

마찬가지로 임계구역 문제를 해결하기 위한 도구.

Mutex lock 과는 달리, 정수 변수를 이용한다. 이를 S 라고 했을 때, S <= 0 일 경우 임계구역 진입을 위해 대기를 하고, 그 외에는 S를 1 감소시키고 임계 구역으로 진입한다.

임계구역을 빠져나올 때 S를 1 증가시킨다.

Mutex Lock 과는 다르게 임계 구역에 동시 접근할 수 있는 프로세스 수를 정할 수 있다.

예를 들어, S = 3 일 때, 3개의 프로세스는 임계구역에 접근이 가능하지만, 그 이후로 접근하려는 프로세스는 기다려야한다.

임계구역에서 빠져나온 프로세스가  S를 증가시키면, 기다리고 있던 프로세스가 S를 감소시키고 임계구역에 진입한다.



# 교착 상태

동기화 도구들을 잘못 사용하면 발생할 수 있는 문제이다.

## 필요 조건

교착 상태를 유발시키기 위해서는 다음 조건들이 필요하다.

### 상호 배제(mutual exclusion)

한 번에 한 스레드만 사용할 수 있는 자원이 존재해야한다.

### 점유하며 대기(hold-and-wait)

스레드가 하나 이상의 자원을 점유한 채, 현재 다른 스레드에 의해 점유된 자원을 추가로 얻기 위해 대기해야한다.

### 비선점(no preemptive)

자원들을 선점할 수 없다.(빼앗아 올 수 없다) 즉, 점유하고 있는 스레드가 자발적으로 방출해야만 한다.

### 순환 대기(circular wait)

대기 중인 스레드의 집합 {T0, T1, ... , Tn}에서 T0 는 T1 의 자원을 요구, T1 는 T2 의 자원을 요구 ... Tn-1 은 Tn 의 자원을 요구, Tn 은 T0 의 자원을 요구한다.



## 해결 방법

* **예방**: 4가지 필요 조건 중 한 가지가 절대 발생하지 않도록 설계한다.
* **회피**: 스레드가 요구하고 사용할 자원들에 대한 정보들을 모두 운영체제가 알고 있는 상태에서, 그 스레드가 기다려야할지 않을지를 결정한다.

# 출처

- 운영체제(10th edition), (Abraham silberschatz, Peter baer galvin, Grag gagne)